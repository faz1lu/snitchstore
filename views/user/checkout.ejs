<!--========================================================= 
    Item Name: Ekka - Ecommerce HTML Template.
    Author: ashishmaraviya
    Version: 3.3
    Copyright 2022-2023
	Author URI: https://themeforest.net/user/ashishmaraviya
 ============================================================-->
<!DOCTYPE html>
<html lang="en">


<!-- Mirrored from loopinfosol.in/themeforest/ekka-html-v33/ekka-html/checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 08 Jan 2023 23:18:32 GMT -->

<head>
  <meta charset="UTF-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

  <title></title>
  <meta name="keywords" content="apparel, catalog, clean, ecommerce, ecommerce HTML, electronics, fashion, html eCommerce, html store, minimal, multipurpose, multipurpose ecommerce, online store, responsive ecommerce template, shops" />
  <meta name="description" content="Best ecommerce html template for single and multi vendor store.">
  <meta name="author" content="ashishmaraviya">

  <!-- site Favicon -->
  <link rel="icon" href="/user/images/favicon/favicon.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="/user/images/favicon/favicon.png" />
  <meta name="msapplication-TileImage" content="/user/images/favicon/favicon.png" />

  <!-- css Icon Font -->
  <link rel="stylesheet" href="/user/css/vendor/ecicons.min.css" />

  <!-- css All Plugins Files -->
  <link rel="stylesheet" href="/user/css/plugins/animate.css" />
  <link rel="stylesheet" href="/user/css/plugins/swiper-bundle.min.css" />
  <link rel="stylesheet" href="/user/css/plugins/jquery-ui.min.css" />
  <link rel="stylesheet" href="/user/css/plugins/countdownTimer.css" />
  <link rel="stylesheet" href="/user/css/plugins/slick.min.css" />
  <link rel="stylesheet" href="/user/css/plugins/nouislider.css" />
  <link rel="stylesheet" href="/user/css/plugins/bootstrap.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
  <!-- Main Style -->
  <link rel="stylesheet" href="/user/css/style.css" />
  <link rel="stylesheet" href="/user/css/responsive.css" />

  <!-- Background css -->
  <link rel="stylesheet" id="bg-switcher-css" href="/user/css/backgrounds/bg-4.css">

</head>

<body class="checkout_page">
  <div id="ec-overlay"><span class="loader_img"></span></div>

  <!-- Header start  -->
  <%-include('partials/header.ejs')%>
  <!-- Header End  -->

  <!-- ekka Cart Start -->
  
  <!-- ekka Cart End -->

  <!-- Ec breadcrumb start -->
  <div class="sticky-header-next-sec  ec-breadcrumb section-space-mb">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="row ec_breadcrumb_inner">
            <div class="col-md-6 col-sm-12">
              <h2 class="ec-breadcrumb-title">Checkout</h2>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Ec breadcrumb end -->

  <!-- Ec checkout page -->
  <section class="ec-page-content section-space-p">
    <div class="container">
      <div class="row">
        <div class="ec-checkout-leftside col-lg-8 col-md-12 ">
          <!-- checkout content Start -->
          <div class="ec-checkout-content">
            <div class="ec-checkout-inner">
             

              <div class="ec-checkout-wrap margin-bottom-30 padding-bottom-3">
                <div class="ec-checkout-block ec-check-bill">
                  <h3 class="ec-checkout-title">Billing Details</h3>
                  <div class="ec-bl-block-content">
                    <!-- <div class="ec-check-subtitle">Checkout Options</div> -->



                    <p>
                      <a class="" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
                        + Add a new address
                      </a>

                    </p>

                    <div class="collapse" id="collapseExample">
                      <!-- <div class="card card-body"> -->
                      <form action="/addresspost" method="post">
                        <div class="ec-check-bill-form">
                          <!-- <form action="/addresspost" method="post"> -->
                          <span class="ec-bill-wrap ec-bill-half">
                            <label>Name</label>
                            <input type="text" name="name" placeholder="Enter your name" required />
                          </span>

                          <span class="ec-bill-wrap">
                            <label>Address</label>
                            <input type="text" name="address" placeholder="enter your address" />
                          </span>
                          <span class="ec-bill-wrap ec-bill-half">
                            <label>City *</label>
                            <input type="text" name="city" placeholder="enter city" />
                            <!-- <span class="ec-bl-select-inner"> -->
                            <!-- <select name="ec_select_city" id="ec-select-city"
                                                                    class="ec-bill-select">
                                                                    <option selected disabled>City</option>
                                                                    <option value="1">City 1</option>
                                                                    <option value="2">City 2</option>
                                                                    <option value="3">City 3</option>
                                                                    <option value="4">City 4</option>
                                                                    <option value="5">City 5</option>
                                                                </select> -->
                            <!-- </span> -->
                          </span>
                          <span class="ec-bill-wrap ec-bill-half">
                            <label>Post Code</label>
                            <input type="text" name="postalcode" placeholder=" post number" />
                          </span>
                          <span class="ec-bill-wrap ec-bill-half">
                            <label>phone number *</label>
                            <input type="text" name="phone" placeholder="enter your phonenumber" />
                            <!-- <span class="ec-bl-select-inner"> -->
                            <!-- <select name="ec_select_country" id="ec-select-country"
                                                                    class="ec-bill-select">
                                                                    <option selected disabled>Country</option>
                                                                    <option value="1">Country 1</option>
                                                                    <option value="2">Country 2</option>
                                                                    <option value="3">Country 3</option>
                                                                    <option value="4">Country 4</option>
                                                                    <option value="5">Country 5</option>
                                                                </select> -->
                            <!-- </span> -->
                          </span>

                          <span class="ec-bill-wrap ec-bill-half">
                            <label>region of state*</label>
                            <input type="text" name="state" placeholder="state" />
                            <!-- <span class="ec-bl-select-inner"> -->
                            <!-- <select name="ec_select_state" id="ec-select-state"
                                                                    class="ec-bill-select">
                                                                    <option selected disabled>Region/State</option>
                                                                    <option value="1">Region/State 1</option>
                                                                    <option value="2">Region/State 2</option>
                                                                    <option value="3">Region/State 3</option>
                                                                    <option value="4">Region/State 4</option>
                                                                    <option value="5">Region/State 5</option>
                                                                </select> -->
                            <!-- </span> -->
                          </span>
                          <span class="ec-check-order-btn mb-4">
                            <button class="btn btn-primary" type="submit">submit</button>
                          </span>

                        </div>

                        <!-- </div> -->
                      </form>
                    </div>
                    <% if (giveadd) { %>
                     
                   <% if (giveadd.address.length>0) { %>
                    
                  
                    <% for(i = 0;i< giveadd.address.length;i++) { %>
                    <section class="md">
                      <div class="container">
                        <div class="row">

                          <div class="form-check">
                            <input class="form-check-input" type="radio" name="address" value="<%=giveadd.address[i]._id  %>" id="address<%=giveadd.address[i]._id  %>" checked>
                            <label class="form-check-label" for="address<%=giveadd.address[i]._id  %>">
                              <p><%=giveadd.address[i].name%></p>
                              <p><%=giveadd.address[i].phone%></p>
                              <p><%=giveadd.address[i].address%></p>
                              <p><%=giveadd.address[i].city%></p>
                              <p><%=giveadd.address[i].state%></p>
                              <p><%=giveadd.address[i].pin%></p>

                              <i class="fa-regular fa-pen-to-square" style="color: brown; height: 20px;width:20 px;"></i>
                              <a  onclick="deleteaddress('<%=giveadd.address[i]._id%>')"><i class="fa-solid fa-trash ml-3" style="color: brown ;"></i></a>
                            </label>

                          </div>



                        </div>
                      </div>
                    </section>
                    <% } %>
                    <% } %>
                    <% } %>




                  </div>
                </div>

              </div>


            </div>
          </div>
          <!--cart content End -->
        </div>
        <!-- Sidebar Area Start -->
        <div class="ec-checkout-rightside col-lg-4 col-md-12">
          <div class="ec-sidebar-wrap">
            <!-- Sidebar Summary Block -->
            <div class="ec-sidebar-block">
              <div class="ec-sb-title">
                <h3 class="ec-sidebar-title">Price details</h3>
              </div>
              <div class="ec-sb-block-content">
                <div class="ec-checkout-summary">
                  <div>
                    <span class="text-left">Sub-Total</span>
                    <span class="text-right" id="total"><%=cartitem.cartTotal%></span>
                    <!-- <span class="text-right"><=checkoutpro.totalprice%> </span> -->
                  </div>
                  <!-- <div>
                    <span class="text-left">Delivery Charges</span>
                    <span class="text-right">$80.00</span>
                  </div> -->

                  <div>
                    <span class="text-left">Coupan</span>
                    <span class="text-right"><a class="ec-checkout-coupan" id="changehead">Apply Coupan</a></span>
                  </div>
                  <div class="ec-checkout-coupan-content">
                   
                    <form class="ec-checkout-coupan-form" name="coupan" id="coupanform">
                      <input class="ec-coupan" type="text" required="" placeholder="Enter Your Coupan Code" name="coupan" id="coupancode">
                      <button class="ec-coupan-btn button btn-primary" type="submit">Apply</button>
                    </form>
                    <p id="invalid"></p>
                  </div>

                  <div class="ec-checkout-summary-total">
                    <span class="text-left">Total Amount</span>
                    <span class="text-right" id="coupanmoney"><%=cartitem.cartTotal%></span>
                  </div>
                </div>

              </div>
            </div>
            <!-- Sidebar Summary Block -->
          </div>
          <div class="ec-sidebar-wrap ec-checkout-del-wrap">

            <div class="ec-sidebar-block">
              <div class="ec-sb-title">
                <h3 class="ec-sidebar-title">Delivery Method</h3>
              </div>
              <div class="ec-sb-block-content">
                <div class="ec-checkout-del">
                  <div class="ec-del-desc">Please select the preferred shipping method to use on this
                    order.</div>
                  <form action="#">
                    <span class="ec-del-option">
                      <span>
                        <span class="ec-del-opt-head"></span>
                        <input type="radio" id="del1" name="paytype" value="COD">
                        <label for="del1"><b>COD</b></label>
                      </span>
                      <span>
                        <span class="ec-del-opt-head"></span>
                        <input type="radio" id="del2" name="paytype" value="paypal">
                        <label for="del2"><b>paypal</b></label>
                        <div id="paypal-button-container"></div>
                      </span>
                    </span>
                    <!-- <span class="ec-del-commemt">
                                            <span class="ec-del-opt-head">Add Comments About Your Order</span>
                                            <textarea name="your-commemt" placeholder="Comments"></textarea>
                                        </span> -->
                  </form>
                </div>
              </div>
            </div>

          </div>

          <span class="ec-check-order-btn">
            <a class="btn btn-primary" onclick="placeorder()">Place Order</a>
          </span>
        </div>
      </div>
    </div>
    <p><%= paypalClindId %>,hi</p>
  </section>

  

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.4/axios.min.js" integrity="sha512-Th6RhKVKcUO1NdowoioG5HrNgi4JzStsjpwheSR+nWcDIVO4Wv6E6D14o/46EqqDsLSca/rcMD1a3OLyPkexAw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=<%= paypalClindId %>" data-namespace="paypal_sdk"></script>
  <script>
    
    $('#coupanform').submit((e) => {
      e.preventDefault()
      console.log('keri-----------------');
      var code = document.getElementById('coupancode').value
      let carttotal = document.getElementById('total').innerHTML

      // if (code == '') {
      //     document.getElementById('error').style.display = 'inline'
      //     setTimeout(() => document.getElementById('error').style.display = 'none', 2000)

      // } else {
      $.ajax({
        url: '/coupancheckout',
        method: 'post',
        dataType: 'json',
        encode: true,
        data: $('#coupanform').serialize() + `&carttotal=${carttotal}`,

        success: ((response) => {
          if (response.status) {
            console.log(response.newcarttotal);

            document.getElementById('changehead').innerHTML = 'coupan applied'
            document.getElementById('changehead').style.color = 'green'
            document.getElementById('coupanform').style.display='none'
            document.getElementById('coupanmoney').innerHTML = response.newcarttotal
            //         document.getElementById('error').innerHTML = 'Minimum cart amount needed'
            //         document.getElementById('error').style.display = 'inline'
            //         setTimeout(() => document.getElementById('error').style.display = 'none', 2000)

            //     }
            //     else if (response.status && clicked == false) {
            //         document.getElementById('success').style.display = 'inline'
            //         setTimeout(() => document.getElementById('success').style.display = 'none', 2000)
            //         // document.getElementById('total').innerHTML = response.redeemedTotal
            //         document.getElementById('coupon').style.display = 'block'
            //         document.getElementById('carttotal').style.display = 'block'
            //         document.getElementById('cartAmount').innerHTML = response.total
            //         document.getElementById('amount').innerHTML = response.redeem


            //         document.getElementById('total').innerHTML = response.redeemedTotal
            //         clicked = true
            //     } else {
            //         document.getElementById('error').innerHTML = 'Already Applied'
            //         document.getElementById('error').style.display = 'inline'
            //         setTimeout(() => document.getElementById('error').style.display = 'none', 2000)

         
          }
        })
      })


    })

    function deleteaddress(id){
      console.log(id);
      axios.post(`/deleteaddresscheckout?id=${id}`).then((result)=>{

      })
    }

    async function placeorder() {
      console.log(1111111111111111111);
      const selectaddress = $('input[type="radio"][name="address"]:checked').val();
      const paytype = $('input[type="radio"][name="paytype"]:checked').val();
      const total = document.getElementById('total').innerHTML
      const changetotal = document.getElementById('coupanmoney').innerHTML
      console.log(selectaddress, paytype, total);

      let res = axios.post(`/placeorder?selectaddress=${selectaddress}&paytype=${paytype}&total=${total}&changetotal${changetotal}`).then((result) => {
        console.log(result)
        if (result.data.COD) {

          // location.href='/successpagesweet'
          // Swal.fire({
          //     title: 'Order Placed Successfully',
          //     icon: "success",
          //     showDenyButton: false,
          //     confirmButtonText: " OK",
          //     toast: true,
          // }).then((result) => {

          //     if (result.Confirmed) {
          //         location.href = "/successpage"
          //     }
          // })


          Swal.fire({
            title: 'order placed successfully',
            showClass: {
              popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
              popup: 'animate__animated animate__fadeOutUp'
            }

          }).then((result) => {
            
              location.href = '/successpagesweet'
            

        })




        } else if (result.data.paypal) {
          console.log(result.data.paypal,'response..........')
          let userOrderData = result.data.userOrderData
          console.log(userOrderData,'userorder data');
         
          let balance = parseInt(result.data.Balance)
          console.log(typeof balance )
          console.log(balance,'amount from the axios response........')
          paypal_sdk.Buttons({
            createOrder: function() {
              console.log("fetchil keri");
              return fetch("/create-order", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  items: [{
                      id: 1,
                      amount: balance,
                    }
                  ]
                })
              }).then(res => {
                console.log(res,'respomse');
                if (res.ok) return res.json()
                console.log(res.json(),"returned");
                return res.json().then(json => Promise.reject(json))
              }).then(({
                id
              }) => {
                console.log("pp");
                return id
              }).catch(e => {
                console.error(e)
              })
            },
            onApprove: function(data, actions) {
             
              return actions.order.capture().then(function(details) {
                console.log("verify ethiiiiiiiiiii");
                  verifyPayment(result)

              })
            }
          }).render('#paypal-button-container');
        }
      })



    }


    function verifyPayment(verify) {
                axios({
                    method: "post",
                    url: "/paypalpost",
                    data:verify
                }).then((result) => {
                    if (result.data.success) {
                      Swal.fire({
            title: 'order placed successfully',
            showClass: {
              popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
              popup: 'animate__animated animate__fadeOutUp'
            }

          }).then((result)=>{

            location.href = "/successpagesweet";
          })
                    }
                });
            }
    
  </script>


  <!-- New Product Start -->
  <!-- <script src="https://www.paypal.com/sdk/js?client-id=AXK7fpaA4Q-sS1iKCGprq-PwLqdBbb8oJC-65cRrhxnhYaIo9GqwuyRAWsNJrVP2QnNk8FCbOfJ2hMif" data-namespace="paypal_sdk"></script> -->
  <!-- New Product end -->

  <!-- Footer Start -->
  <%-include('partials/footer.ejs')-%>
  <!-- Feature tools end -->

  <!-- Vendor JS -->
  <script src="/user/js/vendor/jquery-3.5.1.min.js"></script>
  <script src="/user/js/vendor/popper.min.js"></script>
  <script src="/user/js/vendor/bootstrap.min.js"></script>
  <script src="/user/js/vendor/jquery-migrate-3.3.0.min.js"></script>
  <script src="/user/js/vendor/modernizr-3.11.2.min.js"></script>

  <!--Plugins JS-->
  <script src="/user/js/plugins/swiper-bundle.min.js"></script>
  <script src="/user/js/plugins/countdownTimer.min.js"></script>
  <script src="/user/js/plugins/scrollup.js"></script>
  <script src="/user/js/plugins/jquery.zoom.min.js"></script>
  <script src="/user/js/plugins/slick.min.js"></script>
  <script src="/user/js/plugins/infiniteslidev2.js"></script>
  <script src="/user/js/vendor/jquery.magnific-popup.min.js"></script>
  <script src="/user/js/plugins/jquery.sticky-sidebar.js"></script>
  <!-- Google translate Js -->
  <script src="/user/js/vendor/google-translate.js"></script>
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en'
      }, 'google_translate_element');
    }
  </script>
  <!-- Main Js -->
  <script src="/user/js/vendor/index.js"></script>
  <script src="/user/js/main.js"></script>


</body>

<!-- Mirrored from loopinfosol.in/themeforest/ekka-html-v33/ekka-html/checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 08 Jan 2023 23:18:35 GMT -->

</html>